<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hra: Snake!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            overscroll-behavior: none;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0.5rem;
            overflow: hidden;
        }
        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            touch-action: none;
            position: relative;
        }
        canvas {
            background-color: #2d3748;
            border: 4px solid #1a202c;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            max-width: 100%;
            height: auto;
            display: block;
        }
        .control-button {
            background-color: #4a5568;
            color: white;
            border: 2px solid #2d3748;
            padding: 12px 18px;
            border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px #2d3748;
            margin: 5px;
            font-size: 1.2rem;
            touch-action: manipulation;
        }
        .control-button:hover { background-color: #2d3748; }
        .control-button:active {
            background-color: #1a202c;
            transform: translateY(2px);
            box-shadow: 0 2px #1a202c;
        }
        .hidden { display: none; }
        #messageOverlay, #pauseOverlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            text-align: center;
            padding: 20px;
            background-color: rgba(0,0,0,0.8);
            border-radius: 10px;
            z-index: 10;
            width: 80%;
            max-width: 350px;
        }
        #messageOverlay button {
             font-size: 0.8rem;
             padding: 8px 15px;
        }
        #foodSelect {
            font-family: 'Press Start 2P', cursive;
            background-color: #374151;
            color: #e2e8f0;
            border: 2px solid #4a5568;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            margin-left: 10px;
            cursor: pointer;
        }
        #foodSelect:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 5px rgba(96, 165, 250, 0.5);
        }
        #foodSelect:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .pause-button {
            font-size: 0.7rem;
            padding: 6px 10px;
            background-color: #f59e0b; /* amber-500 */
            color: #78350f; /* amber-900 */
            box-shadow: 0 3px #b45309; /* amber-700 */
        }
        .pause-button:hover { background-color: #d97706; /* amber-600 */ }
        .pause-button:active { box-shadow: 0 1px #b45309; }

        #pauseOverlay {
            font-size: 2rem;
            padding: 30px;
            border: 2px solid #f59e0b;
        }
        .powerup-icon {
            font-size: 1.5rem;
            text-shadow: 0 0 5px white;
        }
        #activeEffectDisplay {
            font-size: 0.8rem;
            min-height: 1.2em;
            color: #facc15; /* yellow-400 */
            margin-top: 5px;
        }
        /* Styl pro High Score */
        .high-score-label {
            color: #f87171; /* Tailwind red-400 */
        }

    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-2 overflow-hidden">

    <header class="mb-2 text-center">
        <h1 class="text-3xl md:text-5xl font-bold text-green-400">SNAKE</h1>
    </header>

    <div class="game-wrapper relative">
         <div class="info-panel grid grid-cols-2 gap-4 w-full px-1 mb-2 text-sm sm:text-lg">
            <p>Sk√≥re: <span id="score" class="text-yellow-400">0</span></p>
            <p class="text-right">Nej: <span id="highScore" class="high-score-label">0</span></p>
            <div class="col-span-2 flex justify-center items-center mt-1">
                 <label for="foodSelect" class="text-xs mr-1">Ovoce:</label>
                 <select id="foodSelect">
                     <option value="üçé">üçé Jablko</option>
                     <option value="üçí">üçí T≈ôe≈°nƒõ</option>
                     <option value="üçì">üçì Jahoda</option>
                     <option value="üçÜ">üçÜ Lilek</option>
                     <option value="‚≠ê">‚≠ê Hvƒõzda</option>
                     <option value="üíé">üíé Diamant</option>
                 </select>
                 <button id="pauseButton" class="control-button pause-button ml-4">PAUZA</button>
            </div>
        </div>
        <div id="activeEffectDisplay" class="text-center mb-2"></div>

        <canvas id="gameCanvas"></canvas>
        <div id="messageOverlay" class="hidden">
            <p id="gameOverText"></p>
            <button id="restartButtonOverlay" class="control-button mt-4">Hr√°t Znovu</button>
        </div>
        <div id="pauseOverlay" class="hidden">PAUZA</div>
    </div>

    <div id="mobileControls" class="mt-4 grid grid-cols-3 gap-2 w-full max-w-xs md:hidden">
        <div></div> <button id="upBtn" class="control-button">‚Üë</button>
        <div></div>
        <button id="leftBtn" class="control-button">‚Üê</button>
        <button id="downBtn" class="control-button">‚Üì</button>
        <button id="rightBtn" class="control-button">‚Üí</button>
    </div>

    <button id="restartButton" class="control-button mt-4 hidden">Restart Hry</button>

    <footer class="mt-4 text-center text-xs text-gray-500">
        Ovl√°d√°n√≠: ≈†ipky / WASD / Swipe / Tlaƒç√≠tka | Pauza: Mezern√≠k
    </footer>

    <script>
        // --- Elementy DOM ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore'); // Nov√Ω element
        const restartButton = document.getElementById('restartButton');
        const foodSelect = document.getElementById('foodSelect');
        const pauseButton = document.getElementById('pauseButton');
        const pauseOverlay = document.getElementById('pauseOverlay');
        const activeEffectDisplay = document.getElementById('activeEffectDisplay');

        const messageOverlay = document.getElementById('messageOverlay');
        const gameOverText = document.getElementById('gameOverText');
        const restartButtonOverlay = document.getElementById('restartButtonOverlay');

        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');

        // --- Hern√≠ stav ---
        const numGridCells = 20;
        let tileSize;
        let snake;
        let food;
        let score = 0;
        let highScore = 0; // Nov√° promƒõnn√°
        let dx, dy;
        let gameLoopTimeout;
        let baseGameSpeed = 280;
        let gameSpeed = baseGameSpeed;
        let gameOverFlag = false;
        let gamePaused = true;
        let gameRunning = false;
        let currentFoodEmoji = 'üçé';

        // --- Power-upy ---
        let powerUp = null;
        let powerUpSpawnTimeout;
        let powerUpDespawnTimeout;
        const POWER_UP_TYPES = {
            SLOWDOWN: { emoji: 'üêå', duration: 5000, effectValue: 1.5 },
            DOUBLE_SCORE: { emoji: '‚ú®', duration: 8000, effectValue: 2 }
        };
        const powerUpSpawnInterval = 10000;
        const powerUpLifespan = 7000;
        let activeEffect = null;
        let activeEffectUpdateInterval;

        // --- Swipe ---
        let touchStartX = 0, touchStartY = 0, touchEndX = 0, touchEndY = 0;
        const swipeThreshold = 30;

        // --- Funkce ---
        function resizeCanvas() {
            const gameWrapper = document.querySelector('.game-wrapper');
            let availableWidth = gameWrapper.clientWidth;
            let availableHeight = window.innerHeight * 0.6;
            let size = Math.min(availableWidth, availableHeight);
            tileSize = Math.floor(size / numGridCells);
            if (tileSize < 8) tileSize = 8;
            canvas.width = tileSize * numGridCells;
            canvas.height = tileSize * numGridCells;
        }

        function initSnake() {
            snake = [{ x: Math.floor(numGridCells / 2) * tileSize, y: Math.floor(numGridCells / 2) * tileSize }];
            dx = tileSize;
            dy = 0;
        }

        function placeItem(itemType) {
            let item = { x: 0, y: 0 };
            let collision = true;
            let attempts = 0;
            while (collision && attempts < 100) {
                item.x = Math.floor(Math.random() * numGridCells) * tileSize;
                item.y = Math.floor(Math.random() * numGridCells) * tileSize;
                collision = false;
                attempts++;
                if (snake) {
                    for (const segment of snake) {
                        if (segment.x === item.x && segment.y === item.y) {
                            collision = true; break;
                        }
                    }
                }
                if (collision) continue;
                if (itemType === 'powerup' && food && food.x === item.x && food.y === item.y) {
                    collision = true; continue;
                }
                if (itemType === 'food' && powerUp && powerUp.x === item.x && powerUp.y === item.y) {
                    collision = true; continue;
                }
            }
            if (attempts >= 100) console.warn("Nepoda≈ôilo se naj√≠t voln√© m√≠sto pro item:", itemType);
            return item;
        }

        function placeFood() {
            const position = placeItem('food');
            food = { ...position, emoji: currentFoodEmoji };
        }

        function spawnPowerUp() {
            if (powerUp || !gameRunning || gamePaused) {
                schedulePowerUpSpawn();
                return;
            }
            const position = placeItem('powerup');
            const types = Object.keys(POWER_UP_TYPES);
            const randomTypeKey = types[Math.floor(Math.random() * types.length)];
            const typeData = POWER_UP_TYPES[randomTypeKey];
            powerUp = { ...position, type: randomTypeKey, emoji: typeData.emoji };
            clearTimeout(powerUpDespawnTimeout);
            powerUpDespawnTimeout = setTimeout(() => { powerUp = null; }, powerUpLifespan);
            schedulePowerUpSpawn();
        }

        function schedulePowerUpSpawn() {
            clearTimeout(powerUpSpawnTimeout);
            if (gameRunning && !gamePaused) {
                const nextSpawnTime = powerUpSpawnInterval + (Math.random() - 0.5) * 5000;
                powerUpSpawnTimeout = setTimeout(spawnPowerUp, nextSpawnTime);
            }
        }

        function activateEffect(type) {
            const typeData = POWER_UP_TYPES[type];
            if (!typeData) return;
            clearTimeout(activeEffect?.timeoutId);
            clearInterval(activeEffectUpdateInterval);

            activeEffect = {
                type: type,
                endTime: Date.now() + typeData.duration,
                timeoutId: setTimeout(deactivateEffect, typeData.duration),
                emoji: typeData.emoji
            };
            updateActiveEffectDisplay(); // Aktualizuje UI hned
            // Spust√≠ interval pro aktualizaci ƒçasu v UI
            activeEffectUpdateInterval = setInterval(updateActiveEffectDisplay, 1000);
        }

        function deactivateEffect() {
            const wasSlowdown = activeEffect?.type === 'SLOWDOWN';
            activeEffect = null;
            clearInterval(activeEffectUpdateInterval);
            updateActiveEffectDisplay();

            if (wasSlowdown && !gamePaused && !gameOverFlag) {
                clearTimeout(gameLoopTimeout);
                gameLoop();
            }
        }

        function updateActiveEffectDisplay() {
            if (activeEffect) {
                const remainingTime = Math.max(0, Math.ceil((activeEffect.endTime - Date.now()) / 1000));
                if (remainingTime > 0) {
                    activeEffectDisplay.innerHTML = `Efekt: ${activeEffect.emoji} (${remainingTime}s)`;
                } else {
                    // Pokud ƒças vypr≈°el, ale timeout je≈°tƒõ nebyl zpracov√°n (clearInterval mohl b√Ωt rychlej≈°√≠)
                    deactivateEffect();
                }
            } else {
                activeEffectDisplay.innerHTML = '';
                clearInterval(activeEffectUpdateInterval);
            }
        }

        function draw() {
            ctx.fillStyle = '#2d3748';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (food) {
                const fontSize = tileSize * 0.8;
                ctx.font = `${fontSize}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(food.emoji, food.x + tileSize / 2, food.y + tileSize / 2 + fontSize * 0.08);
            }

            if (powerUp) {
                 const fontSize = tileSize * 1.0;
                 ctx.font = `${fontSize}px sans-serif`;
                 ctx.textAlign = 'center';
                 ctx.textBaseline = 'middle';
                 ctx.globalAlpha = 0.7 + Math.sin(Date.now() / 200) * 0.3;
                 ctx.shadowColor = "white";
                 ctx.shadowBlur = 10;
                 ctx.fillText(powerUp.emoji, powerUp.x + tileSize / 2, powerUp.y + tileSize / 2 + fontSize * 0.08);
                 ctx.globalAlpha = 1.0;
                 ctx.shadowBlur = 0;
            }

            if (snake) {
                snake.forEach((segment, index) => {
                    ctx.fillStyle = (index === 0) ? '#48bb78' : '#68d391';
                    ctx.fillRect(segment.x, segment.y, tileSize - 1, tileSize - 1);
                    ctx.strokeStyle = '#2d3748';
                    ctx.strokeRect(segment.x, segment.y, tileSize, tileSize);
                });
            }
        }

        function update() {
            if (gamePaused || gameOverFlag) return;

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
                gameOver(); return;
            }
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver(); return;
                }
            }

            snake.unshift(head);

            if (head.x === food.x && head.y === food.y) {
                const scoreMultiplier = activeEffect?.type === 'DOUBLE_SCORE' ? POWER_UP_TYPES.DOUBLE_SCORE.effectValue : 1;
                score += (1 * scoreMultiplier);
                // scoreDisplay.textContent = score; // Aktualizujeme v drawScoreAndHighScore
                placeFood();
                if (score > 0 && score % 5 === 0 && baseGameSpeed > 80) {
                    baseGameSpeed -= 10;
                }
            }
            else if (powerUp && head.x === powerUp.x && head.y === powerUp.y) {
                activateEffect(powerUp.type);
                powerUp = null;
                clearTimeout(powerUpDespawnTimeout);
                snake.pop();
            }
            else {
                snake.pop();
            }
        }

        function gameLoop() {
            if (gameOverFlag) {
                 clearTimeout(gameLoopTimeout);
                 return;
            }
             if (gamePaused) {
                 gameLoopTimeout = setTimeout(gameLoop, 100);
                 return;
             }

            update();
            draw();
            drawScoreAndHighScore(); // P≈ôesunuto sem pro aktu√°ln√≠ zobrazen√≠

            const speedMultiplier = activeEffect?.type === 'SLOWDOWN' ? POWER_UP_TYPES.SLOWDOWN.effectValue : 1;
            const currentSpeed = baseGameSpeed * speedMultiplier;

            gameLoopTimeout = setTimeout(gameLoop, currentSpeed);
        }

        // Funkce pro naƒçten√≠ high score z localStorage
        function loadHighScore() {
            const storedHighScore = localStorage.getItem('snakeHighScore');
            highScore = storedHighScore ? parseInt(storedHighScore, 10) : 0;
        }

        // Funkce pro ulo≈æen√≠ high score do localStorage (pokud je p≈ôekon√°no)
        function updateHighScore() {
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
            }
        }

        // Funkce pro vykreslen√≠ sk√≥re a high score
        function drawScoreAndHighScore() {
            scoreDisplay.textContent = score;
            highScoreDisplay.textContent = highScore; // Zobraz√≠ naƒçten√©/aktu√°ln√≠ high score
        }


        function gameOver() {
            gameOverFlag = true;
            gameRunning = false;
            gamePaused = true;
            clearTimeout(gameLoopTimeout);
            clearTimeout(powerUpSpawnTimeout);
            clearTimeout(powerUpDespawnTimeout);
            clearTimeout(activeEffect?.timeoutId);
            clearInterval(activeEffectUpdateInterval);
            updateHighScore(); // Zkontroluje a ulo≈æ√≠ high score
            activeEffect = null;
            powerUp = null;
            updateActiveEffectDisplay();
            gameOverText.textContent = `KONEC HRY! Sk√≥re: ${score}`;
            messageOverlay.classList.remove('hidden');
            restartButton.classList.remove('hidden');
            foodSelect.disabled = false;
            pauseButton.textContent = "PAUZA";
            pauseButton.disabled = true;
            pauseOverlay.classList.add('hidden');
        }

        function changeDirection(newDx, newDy) {
            if (dx !== 0 && newDx !== 0 && dx === -newDx) return;
            if (dy !== 0 && newDy !== 0 && dy === -newDy) return;
            dx = newDx;
            dy = newDy;
        }

        function togglePause() {
            if (gameOverFlag) return;

            gamePaused = !gamePaused;
            if (gamePaused) {
                pauseButton.textContent = "POKRAƒåOVAT";
                pauseOverlay.classList.remove('hidden');
                foodSelect.disabled = false;
                clearTimeout(powerUpSpawnTimeout);
                clearInterval(activeEffectUpdateInterval);
            } else {
                pauseButton.textContent = "PAUZA";
                pauseOverlay.classList.add('hidden');
                foodSelect.disabled = true;
                schedulePowerUpSpawn();
                if (activeEffect) { // Znovu spust√≠ update UI pro aktivn√≠ efekt
                    clearInterval(activeEffectUpdateInterval); // Pro jistotu
                    activeEffectUpdateInterval = setInterval(updateActiveEffectDisplay, 1000);
                    updateActiveEffectDisplay();
                }
                clearTimeout(gameLoopTimeout);
                gameLoop();
            }
        }

        // --- Ovl√°d√°n√≠ ---
        document.addEventListener('keydown', e => {
            const keyPressed = e.key.toLowerCase();

            if (!gameOverFlag && !gamePaused) { // Ovl√°d√°n√≠ smƒõru
                if ((keyPressed === 'arrowup' || keyPressed === 'w') && dy === 0) changeDirection(0, -tileSize);
                else if ((keyPressed === 'arrowdown' || keyPressed === 's') && dy === 0) changeDirection(0, tileSize);
                else if ((keyPressed === 'arrowleft' || keyPressed === 'a') && dx === 0) changeDirection(-tileSize, 0);
                else if ((keyPressed === 'arrowright' || keyPressed === 'd') && dx === 0) changeDirection(tileSize, 0);
            }

            // Pauza Mezern√≠kem
            if (keyPressed === ' ' && !gameOverFlag) {
                 e.preventDefault();
                 togglePause();
            }

            // Restart Enterem
            if (keyPressed === 'enter' && gameOverFlag) {
                 startGame();
            }
        });

        // Mobiln√≠ tlaƒç√≠tka
        if (upBtn) upBtn.addEventListener('click', () => { if (dy === 0 && !gameOverFlag && !gamePaused) changeDirection(0, -tileSize); });
        if (downBtn) downBtn.addEventListener('click', () => { if (dy === 0 && !gameOverFlag && !gamePaused) changeDirection(0, tileSize); });
        if (leftBtn) leftBtn.addEventListener('click', () => { if (dx === 0 && !gameOverFlag && !gamePaused) changeDirection(-tileSize, 0); });
        if (rightBtn) rightBtn.addEventListener('click', () => { if (dx === 0 && !gameOverFlag && !gamePaused) changeDirection(tileSize, 0); });

        // Swipe ovl√°d√°n√≠
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            if (!gameOverFlag && !gamePaused) { handleSwipe(); }
        }, { passive: false });

        function handleSwipe() { /* ... k√≥d pro swipe z≈Øst√°v√° stejn√Ω ... */
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);

            if (absDeltaX > swipeThreshold || absDeltaY > swipeThreshold) {
                if (absDeltaX > absDeltaY) { // Horizont√°ln√≠
                    if (deltaX > 0 && dx === 0) changeDirection(tileSize, 0);
                    else if (deltaX < 0 && dx === 0) changeDirection(-tileSize, 0);
                } else { // Vertik√°ln√≠
                    if (deltaY > 0 && dy === 0) changeDirection(0, tileSize);
                    else if (deltaY < 0 && dy === 0) changeDirection(0, -tileSize);
                }
            }
        }

        // Listener pro zmƒõnu v√Ωbƒõru ovoce
        foodSelect.addEventListener('change', (e) => {
            currentFoodEmoji = e.target.value;
            if (food && (gamePaused || gameOverFlag)) {
                food.emoji = currentFoodEmoji;
                draw();
            }
        });

        // Listener pro tlaƒç√≠tko Pauza/Pokraƒçovat
        pauseButton.addEventListener('click', togglePause);


        // --- Spu≈°tƒõn√≠ a Restart ---
        function startGame() {
            resizeCanvas();
            initSnake();
            currentFoodEmoji = foodSelect.value;
            placeFood();
            score = 0;
            // scoreDisplay.textContent = score; // Aktualizujeme v drawScoreAndHighScore
            gameOverFlag = false;
            gamePaused = false;
            gameRunning = true;
            baseGameSpeed = 280;
            gameSpeed = baseGameSpeed;

            powerUp = null;
            activeEffect = null;
            clearTimeout(powerUpSpawnTimeout);
            clearTimeout(powerUpDespawnTimeout);
            clearTimeout(activeEffect?.timeoutId);
            clearInterval(activeEffectUpdateInterval);
            updateActiveEffectDisplay();

            messageOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            restartButton.classList.add('hidden');
            foodSelect.disabled = true;
            pauseButton.textContent = "PAUZA";
            pauseButton.disabled = false;

            drawScoreAndHighScore(); // Zobraz√≠ poƒç√°teƒçn√≠ sk√≥re (0) a high score
            clearTimeout(gameLoopTimeout);
            gameLoop();
            schedulePowerUpSpawn();
        }

        restartButton.addEventListener('click', startGame);
        restartButtonOverlay.addEventListener('click', startGame);

        window.addEventListener('resize', () => {
            const wasPausedBeforeResize = gamePaused;
            const wasRunningBeforeResize = gameRunning;
            const wasGameOver = gameOverFlag;

            clearTimeout(gameLoopTimeout);
            clearTimeout(powerUpSpawnTimeout);
            clearInterval(activeEffectUpdateInterval);
            gamePaused = true;

            resizeCanvas();

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (snake && food) { draw(); } else { initializeGameUI(); return; }
            drawScoreAndHighScore(); // P≈ôekresl√≠me i sk√≥re

            if (wasGameOver) {
                 gameOver();
            } else if (wasRunningBeforeResize && !wasPausedBeforeResize) {
                gamePaused = false;
                foodSelect.disabled = true;
                pauseButton.disabled = false;
                pauseButton.textContent = "PAUZA";
                gameLoop();
                schedulePowerUpSpawn();
                updateActiveEffectDisplay();
            } else if (wasPausedBeforeResize && wasRunningBeforeResize) {
                gamePaused = true;
                pauseOverlay.classList.remove('hidden');
                foodSelect.disabled = false;
                pauseButton.textContent = "POKRAƒåOVAT";
                pauseButton.disabled = false;
                updateActiveEffectDisplay();
            } else {
                initializeGameUI();
            }
        });

        // --- Inicializace ---
        function initializeGameUI() {
            loadHighScore(); // Naƒçte high score p≈ôi inicializaci
            resizeCanvas();
            initSnake();
            currentFoodEmoji = foodSelect.value;
            placeFood();
            draw();
            score = 0;
            // scoreDisplay.textContent = score; // Aktualizujeme v drawScoreAndHighScore
            drawScoreAndHighScore(); // Zobraz√≠ 0 a naƒçten√© high score
            foodSelect.disabled = false;
            pauseButton.disabled = true;
            messageOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            restartButton.classList.add('hidden');
            activeEffectDisplay.innerHTML = '';
            gamePaused = true;
            gameRunning = false;
            gameOverFlag = false;
            powerUp = null;
            activeEffect = null;
            if(gameLoopTimeout) clearTimeout(gameLoopTimeout);
            if(powerUpSpawnTimeout) clearTimeout(powerUpSpawnTimeout);
            if(powerUpDespawnTimeout) clearTimeout(powerUpDespawnTimeout);
            if(activeEffect?.timeoutId) clearTimeout(activeEffect.timeoutId);
            if(activeEffectUpdateInterval) clearInterval(activeEffectUpdateInterval);
        }

        initializeGameUI();
    </script>

</body>
</html>
