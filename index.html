<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Hra: Snake!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            overscroll-behavior: none;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 0.5rem;
            overflow: hidden;
        }
        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            touch-action: none;
            position: relative;
        }
        canvas {
            background-color: #2d3748;
            border: 4px solid #1a202c;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            max-width: 100%;
            height: auto;
            display: block;
        }
        .control-button {
            background-color: #4a5568;
            color: white;
            border: 2px solid #2d3748;
            padding: 12px 18px;
            border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px #2d3748;
            margin: 5px;
            font-size: 1.2rem;
            touch-action: manipulation;
        }
        .control-button:hover { background-color: #2d3748; }
        .control-button:active {
            background-color: #1a202c;
            transform: translateY(2px);
            box-shadow: 0 2px #1a202c;
        }
        .hidden { display: none; }
        #messageOverlay, #pauseOverlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.2rem;
            text-align: center;
            padding: 20px;
            background-color: rgba(0,0,0,0.8);
            border-radius: 10px;
            z-index: 10;
            width: 80%;
            max-width: 350px;
        }
        #messageOverlay button {
             font-size: 0.8rem;
             padding: 8px 15px;
        }
        #foodSelect {
            font-family: 'Press Start 2P', cursive;
            background-color: #374151;
            color: #e2e8f0;
            border: 2px solid #4a5568;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            margin-left: 10px;
            cursor: pointer;
        }
        #foodSelect:focus {
            outline: none;
            border-color: #60a5fa;
            box-shadow: 0 0 5px rgba(96, 165, 250, 0.5);
        }
        #foodSelect:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .pause-button {
            font-size: 0.7rem;
            padding: 6px 10px;
            background-color: #f59e0b; /* amber-500 */
            color: #78350f; /* amber-900 */
            box-shadow: 0 3px #b45309; /* amber-700 */
        }
        .pause-button:hover { background-color: #d97706; /* amber-600 */ }
        .pause-button:active { box-shadow: 0 1px #b45309; }

        #pauseOverlay {
            font-size: 2rem;
            padding: 30px;
            border: 2px solid #f59e0b;
        }
        /* Styl pro power-upy a aktivn√≠ efekt */
        .powerup-icon { /* Bude pou≈æito v JS pro kreslen√≠ */
            font-size: 1.5rem; /* Vƒõt≈°√≠ ne≈æ ovoce */
            text-shadow: 0 0 5px white;
        }
        #activeEffectDisplay {
            font-size: 0.8rem;
            min-height: 1.2em; /* Aby layout neposkakoval */
            color: #facc15; /* yellow-400 */
            margin-top: 5px;
        }

    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-2 overflow-hidden">

    <header class="mb-2 text-center">
        <h1 class="text-3xl md:text-5xl font-bold text-green-400">SNAKE</h1>
    </header>

    <div class="game-wrapper relative">
         <div class="info-panel flex justify-between items-center w-full px-1 mb-2">
            <p class="text-lg">Sk√≥re: <span id="score" class="text-yellow-400">0</span></p>
            <div class="flex items-center">
                 <label for="foodSelect" class="text-xs mr-1">Ovoce:</label>
                 <select id="foodSelect">
                     <option value="üçé">üçé Jablko</option>
                     <option value="üçí">üçí T≈ôe≈°nƒõ</option>
                     <option value="üçì">üçì Jahoda</option>
                     <option value="üçÜ">üçÜ Lilek</option>
                     <option value="‚≠ê">‚≠ê Hvƒõzda</option>
                     <option value="üíé">üíé Diamant</option>
                 </select>
                 <button id="pauseButton" class="control-button pause-button ml-4">PAUZA</button>
            </div>
        </div>
        <div id="activeEffectDisplay" class="text-center mb-2"></div>

        <canvas id="gameCanvas"></canvas>
        <div id="messageOverlay" class="hidden">
            <p id="gameOverText"></p>
            <button id="restartButtonOverlay" class="control-button mt-4">Hr√°t Znovu</button>
        </div>
        <div id="pauseOverlay" class="hidden">PAUZA</div>
    </div>

    <div id="mobileControls" class="mt-4 grid grid-cols-3 gap-2 w-full max-w-xs md:hidden">
        <div></div> <button id="upBtn" class="control-button">‚Üë</button>
        <div></div>
        <button id="leftBtn" class="control-button">‚Üê</button>
        <button id="downBtn" class="control-button">‚Üì</button>
        <button id="rightBtn" class="control-button">‚Üí</button>
    </div>

    <button id="restartButton" class="control-button mt-4 hidden">Restart Hry</button>

    <footer class="mt-4 text-center text-xs text-gray-500">
        Ovl√°d√°n√≠: ≈†ipky / WASD / Swipe / Tlaƒç√≠tka | Pauza: Mezern√≠k
    </footer>

    <script>
        // --- Elementy DOM ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const restartButton = document.getElementById('restartButton');
        const foodSelect = document.getElementById('foodSelect');
        const pauseButton = document.getElementById('pauseButton');
        const pauseOverlay = document.getElementById('pauseOverlay');
        const activeEffectDisplay = document.getElementById('activeEffectDisplay'); // Nov√Ω element

        const messageOverlay = document.getElementById('messageOverlay');
        const gameOverText = document.getElementById('gameOverText');
        const restartButtonOverlay = document.getElementById('restartButtonOverlay');

        const upBtn = document.getElementById('upBtn');
        const downBtn = document.getElementById('downBtn');
        const leftBtn = document.getElementById('leftBtn');
        const rightBtn = document.getElementById('rightBtn');

        // --- Hern√≠ stav ---
        const numGridCells = 20;
        let tileSize;
        let snake;
        let food;
        let score = 0;
        let dx, dy;
        let gameLoopTimeout;
        let baseGameSpeed = 280; // Z√°kladn√≠ rychlost
        let gameSpeed = baseGameSpeed; // Aktu√°ln√≠ rychlost
        let gameOverFlag = false;
        let gamePaused = true;
        let gameRunning = false;
        let currentFoodEmoji = 'üçé';

        // --- Power-upy ---
        let powerUp = null; // M≈Ø≈æe b√Ωt jen jeden power-up najednou {x, y, type, emoji}
        let powerUpSpawnTimeout;
        let powerUpDespawnTimeout;
        const POWER_UP_TYPES = {
            SLOWDOWN: { emoji: 'üêå', duration: 5000, effectValue: 1.5 }, // Zpomalen√≠ (n√°sobitel rychlosti)
            DOUBLE_SCORE: { emoji: '‚ú®', duration: 8000, effectValue: 2 } // Dvojit√© sk√≥re (n√°sobitel sk√≥re)
        };
        const powerUpSpawnInterval = 10000; // Ka≈æd√Ωch 10 sekund ≈°ance na spawn
        const powerUpLifespan = 7000; // Power-up zmiz√≠ po 7 sekund√°ch
        let activeEffect = null; // { type: 'SLOWDOWN'/'DOUBLE_SCORE', timeoutId: null, endTime: null, emoji: 'üêå'/'‚ú®' }
        let activeEffectUpdateInterval; // Interval pro aktualizaci UI ƒçasu efektu

        // --- Swipe ---
        let touchStartX = 0, touchStartY = 0, touchEndX = 0, touchEndY = 0;
        const swipeThreshold = 30;

        // --- Funkce ---
        function resizeCanvas() {
            const gameWrapper = document.querySelector('.game-wrapper');
            let availableWidth = gameWrapper.clientWidth;
            let availableHeight = window.innerHeight * 0.6; // M√≠rnƒõ men≈°√≠ prostor pro UI
            let size = Math.min(availableWidth, availableHeight);
            tileSize = Math.floor(size / numGridCells);
            if (tileSize < 8) tileSize = 8;
            canvas.width = tileSize * numGridCells;
            canvas.height = tileSize * numGridCells;
        }

        function initSnake() {
            snake = [{ x: Math.floor(numGridCells / 2) * tileSize, y: Math.floor(numGridCells / 2) * tileSize }];
            dx = tileSize;
            dy = 0;
        }

        function placeItem(itemType) { // Obecn√° funkce pro um√≠stƒõn√≠ j√≠dla nebo power-upu
            let item = { x: 0, y: 0 };
            let collision = true;
            let attempts = 0; // Pojistka proti nekoneƒçn√© smyƒçce
            while (collision && attempts < 100) {
                item.x = Math.floor(Math.random() * numGridCells) * tileSize;
                item.y = Math.floor(Math.random() * numGridCells) * tileSize;
                collision = false;
                attempts++;
                // Kolize s hadem
                if (snake) {
                    for (const segment of snake) {
                        if (segment.x === item.x && segment.y === item.y) {
                            collision = true; break;
                        }
                    }
                }
                if (collision) continue;
                // Kolize s j√≠dlem (pokud umis≈•ujeme power-up)
                if (itemType === 'powerup' && food && food.x === item.x && food.y === item.y) {
                    collision = true; continue;
                }
                // Kolize s power-upem (pokud umis≈•ujeme j√≠dlo)
                if (itemType === 'food' && powerUp && powerUp.x === item.x && powerUp.y === item.y) {
                    collision = true; continue;
                }
            }
            if (attempts >= 100) console.warn("Nepoda≈ôilo se naj√≠t voln√© m√≠sto pro item:", itemType);
            return item;
        }

        function placeFood() {
            const position = placeItem('food');
            food = { ...position, emoji: currentFoodEmoji };
        }

        function spawnPowerUp() {
            if (powerUp || !gameRunning || gamePaused) {
                schedulePowerUpSpawn();
                return;
            }
            const position = placeItem('powerup');
            const types = Object.keys(POWER_UP_TYPES);
            const randomTypeKey = types[Math.floor(Math.random() * types.length)];
            const typeData = POWER_UP_TYPES[randomTypeKey];
            powerUp = { ...position, type: randomTypeKey, emoji: typeData.emoji };
            clearTimeout(powerUpDespawnTimeout);
            powerUpDespawnTimeout = setTimeout(() => { powerUp = null; }, powerUpLifespan);
            schedulePowerUpSpawn();
        }

        function schedulePowerUpSpawn() {
            clearTimeout(powerUpSpawnTimeout);
            if (gameRunning && !gamePaused) {
                const nextSpawnTime = powerUpSpawnInterval + (Math.random() - 0.5) * 5000;
                powerUpSpawnTimeout = setTimeout(spawnPowerUp, nextSpawnTime);
            }
        }

        function activateEffect(type) {
            const typeData = POWER_UP_TYPES[type];
            if (!typeData) return;
            clearTimeout(activeEffect?.timeoutId); // Zru≈°√≠ p≈ôedchoz√≠ timeout efektu
            clearInterval(activeEffectUpdateInterval); // Zru≈°√≠ p≈ôedchoz√≠ interval UI

            activeEffect = {
                type: type,
                endTime: Date.now() + typeData.duration,
                timeoutId: setTimeout(deactivateEffect, typeData.duration),
                emoji: typeData.emoji
            };
            updateActiveEffectDisplay(); // Aktualizuje UI hned
        }

        function deactivateEffect() {
            // Pokud se deaktivuje zpomalen√≠, mus√≠me p≈ôepoƒç√≠tat rychlost smyƒçky
            const wasSlowdown = activeEffect?.type === 'SLOWDOWN';
            activeEffect = null;
            clearInterval(activeEffectUpdateInterval); // Zastav√≠ aktualizaci UI
            updateActiveEffectDisplay(); // Vyma≈æe UI

            if (wasSlowdown && !gamePaused && !gameOverFlag) {
                // Restartujeme smyƒçku s novou (z√°kladn√≠) rychlost√≠
                clearTimeout(gameLoopTimeout);
                gameLoop();
            }
        }

        function updateActiveEffectDisplay() {
            if (activeEffect) {
                const remainingTime = Math.max(0, Math.ceil((activeEffect.endTime - Date.now()) / 1000));
                if (remainingTime > 0) {
                    activeEffectDisplay.innerHTML = `Efekt: ${activeEffect.emoji} (${remainingTime}s)`;
                } else {
                    // Pokud ƒças vypr≈°el, ale timeout je≈°tƒõ nebyl zpracov√°n
                    deactivateEffect();
                }
            } else {
                activeEffectDisplay.innerHTML = '';
                clearInterval(activeEffectUpdateInterval); // Zastav√≠ interval, pokud u≈æ nen√≠ efekt
            }
        }


        function draw() {
            ctx.fillStyle = '#2d3748';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (food) {
                const fontSize = tileSize * 0.8;
                ctx.font = `${fontSize}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(food.emoji, food.x + tileSize / 2, food.y + tileSize / 2 + fontSize * 0.08);
            }

            if (powerUp) {
                 const fontSize = tileSize * 1.0;
                 ctx.font = `${fontSize}px sans-serif`;
                 ctx.textAlign = 'center';
                 ctx.textBaseline = 'middle';
                 ctx.globalAlpha = 0.7 + Math.sin(Date.now() / 200) * 0.3; // Blik√°n√≠
                 ctx.shadowColor = "white";
                 ctx.shadowBlur = 10;
                 ctx.fillText(powerUp.emoji, powerUp.x + tileSize / 2, powerUp.y + tileSize / 2 + fontSize * 0.08);
                 ctx.globalAlpha = 1.0;
                 ctx.shadowBlur = 0;
            }

            if (snake) {
                snake.forEach((segment, index) => {
                    ctx.fillStyle = (index === 0) ? '#48bb78' : '#68d391';
                    ctx.fillRect(segment.x, segment.y, tileSize - 1, tileSize - 1);
                    ctx.strokeStyle = '#2d3748';
                    ctx.strokeRect(segment.x, segment.y, tileSize, tileSize);
                });
            }
        }

        function update() {
            if (gamePaused || gameOverFlag) return;

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            if (head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height) {
                gameOver(); return;
            }
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver(); return;
                }
            }

            snake.unshift(head);

            // Kolize s j√≠dlem
            if (head.x === food.x && head.y === food.y) {
                const scoreMultiplier = activeEffect?.type === 'DOUBLE_SCORE' ? POWER_UP_TYPES.DOUBLE_SCORE.effectValue : 1;
                score += (1 * scoreMultiplier);
                scoreDisplay.textContent = score;
                placeFood();
                if (score > 0 && score % 5 === 0 && baseGameSpeed > 80) {
                    baseGameSpeed -= 10;
                }
            }
            // Kolize s power-upem
            else if (powerUp && head.x === powerUp.x && head.y === powerUp.y) {
                activateEffect(powerUp.type);
                powerUp = null;
                clearTimeout(powerUpDespawnTimeout);
                snake.pop(); // Had neroste
            }
            else {
                snake.pop();
            }
        }

        function gameLoop() {
            if (gameOverFlag) {
                 clearTimeout(gameLoopTimeout);
                 return;
            }
             if (gamePaused) {
                 gameLoopTimeout = setTimeout(gameLoop, 100); // Kontroluje stav pauzy
                 return;
             }

            update();
            draw();

            const speedMultiplier = activeEffect?.type === 'SLOWDOWN' ? POWER_UP_TYPES.SLOWDOWN.effectValue : 1;
            const currentSpeed = baseGameSpeed * speedMultiplier;

            gameLoopTimeout = setTimeout(gameLoop, currentSpeed);
        }

        function gameOver() {
            gameOverFlag = true;
            gameRunning = false;
            gamePaused = true;
            clearTimeout(gameLoopTimeout);
            clearTimeout(powerUpSpawnTimeout);
            clearTimeout(powerUpDespawnTimeout);
            clearTimeout(activeEffect?.timeoutId);
            clearInterval(activeEffectUpdateInterval); // Zastav√≠ UI interval
            activeEffect = null;
            powerUp = null;
            updateActiveEffectDisplay();
            gameOverText.textContent = `KONEC HRY! Sk√≥re: ${score}`;
            messageOverlay.classList.remove('hidden');
            restartButton.classList.remove('hidden');
            foodSelect.disabled = false;
            pauseButton.textContent = "PAUZA";
            pauseButton.disabled = true;
            pauseOverlay.classList.add('hidden');
        }

        function changeDirection(newDx, newDy) {
            if (dx !== 0 && newDx !== 0 && dx === -newDx) return;
            if (dy !== 0 && newDy !== 0 && dy === -newDy) return;
            dx = newDx;
            dy = newDy;
        }

        function togglePause() {
            if (gameOverFlag) return;

            gamePaused = !gamePaused;
            if (gamePaused) {
                pauseButton.textContent = "POKRAƒåOVAT";
                pauseOverlay.classList.remove('hidden');
                foodSelect.disabled = false;
                clearTimeout(powerUpSpawnTimeout);
                clearInterval(activeEffectUpdateInterval); // Zastav√≠ UI interval p≈ôi pauze
                // Smyƒçka se zastav√≠ sama
            } else {
                pauseButton.textContent = "PAUZA";
                pauseOverlay.classList.add('hidden');
                foodSelect.disabled = true;
                schedulePowerUpSpawn(); // Znovu napl√°nuje spawn
                updateActiveEffectDisplay(); // Spust√≠ aktualizaci UI efektu
                // Explicitnƒõ spust√≠me dal≈°√≠ krok smyƒçky
                clearTimeout(gameLoopTimeout);
                gameLoop();
            }
        }

        // --- Ovl√°d√°n√≠ ---
        document.addEventListener('keydown', e => {
            const keyPressed = e.key.toLowerCase();

            if (!gameOverFlag && !gamePaused) { // Ovl√°d√°n√≠ smƒõru
                if ((keyPressed === 'arrowup' || keyPressed === 'w') && dy === 0) changeDirection(0, -tileSize);
                else if ((keyPressed === 'arrowdown' || keyPressed === 's') && dy === 0) changeDirection(0, tileSize);
                else if ((keyPressed === 'arrowleft' || keyPressed === 'a') && dx === 0) changeDirection(-tileSize, 0);
                else if ((keyPressed === 'arrowright' || keyPressed === 'd') && dx === 0) changeDirection(tileSize, 0);
            }

            // Pauza Mezern√≠kem
            if (keyPressed === ' ' && !gameOverFlag) {
                 e.preventDefault();
                 togglePause();
            }

            // Restart Enterem
            if (keyPressed === 'enter' && gameOverFlag) {
                 startGame();
            }
        });

        // Mobiln√≠ tlaƒç√≠tka
        if (upBtn) upBtn.addEventListener('click', () => { if (dy === 0 && !gameOverFlag && !gamePaused) changeDirection(0, -tileSize); });
        if (downBtn) downBtn.addEventListener('click', () => { if (dy === 0 && !gameOverFlag && !gamePaused) changeDirection(0, tileSize); });
        if (leftBtn) leftBtn.addEventListener('click', () => { if (dx === 0 && !gameOverFlag && !gamePaused) changeDirection(-tileSize, 0); });
        if (rightBtn) rightBtn.addEventListener('click', () => { if (dx === 0 && !gameOverFlag && !gamePaused) changeDirection(tileSize, 0); });

        // Swipe ovl√°d√°n√≠
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            if (!gameOverFlag && !gamePaused) { handleSwipe(); }
        }, { passive: false });

        function handleSwipe() { /* ... k√≥d pro swipe z≈Øst√°v√° stejn√Ω ... */
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            const absDeltaX = Math.abs(deltaX);
            const absDeltaY = Math.abs(deltaY);

            if (absDeltaX > swipeThreshold || absDeltaY > swipeThreshold) {
                if (absDeltaX > absDeltaY) { // Horizont√°ln√≠
                    if (deltaX > 0 && dx === 0) changeDirection(tileSize, 0);
                    else if (deltaX < 0 && dx === 0) changeDirection(-tileSize, 0);
                } else { // Vertik√°ln√≠
                    if (deltaY > 0 && dy === 0) changeDirection(0, tileSize);
                    else if (deltaY < 0 && dy === 0) changeDirection(0, -tileSize);
                }
            }
        }

        // Listener pro zmƒõnu v√Ωbƒõru ovoce
        foodSelect.addEventListener('change', (e) => {
            currentFoodEmoji = e.target.value;
            if (food && (gamePaused || gameOverFlag)) {
                food.emoji = currentFoodEmoji;
                draw();
            }
        });

        // Listener pro tlaƒç√≠tko Pauza/Pokraƒçovat
        pauseButton.addEventListener('click', togglePause);


        // --- Spu≈°tƒõn√≠ a Restart ---
        function startGame() {
            resizeCanvas();
            initSnake();
            currentFoodEmoji = foodSelect.value;
            placeFood();
            score = 0;
            scoreDisplay.textContent = score;
            gameOverFlag = false;
            gamePaused = false;
            gameRunning = true;
            baseGameSpeed = 280;
            gameSpeed = baseGameSpeed; // Nastaven√≠ aktu√°ln√≠ rychlosti

            // Reset power-up≈Ø a efekt≈Ø
            powerUp = null;
            activeEffect = null;
            clearTimeout(powerUpSpawnTimeout);
            clearTimeout(powerUpDespawnTimeout);
            clearTimeout(activeEffect?.timeoutId);
            clearInterval(activeEffectUpdateInterval); // Zastav√≠ UI interval
            updateActiveEffectDisplay(); // Vyƒçist√≠ UI

            messageOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            restartButton.classList.add('hidden');
            foodSelect.disabled = true;
            pauseButton.textContent = "PAUZA";
            pauseButton.disabled = false;

            clearTimeout(gameLoopTimeout);
            gameLoop(); // Spust√≠ hern√≠ smyƒçku
            schedulePowerUpSpawn(); // Napl√°nuje prvn√≠ spawn power-upu
        }

        restartButton.addEventListener('click', startGame);
        restartButtonOverlay.addEventListener('click', startGame);

        window.addEventListener('resize', () => {
            const wasPausedBeforeResize = gamePaused;
            const wasRunningBeforeResize = gameRunning;
            const wasGameOver = gameOverFlag;

            clearTimeout(gameLoopTimeout);
            clearTimeout(powerUpSpawnTimeout);
            clearInterval(activeEffectUpdateInterval); // Zastav√≠ UI interval
            gamePaused = true;

            resizeCanvas();

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (snake && food) { draw(); } else { initializeGameUI(); return; }

            if (wasGameOver) {
                 gameOver();
            } else if (wasRunningBeforeResize && !wasPausedBeforeResize) {
                gamePaused = false;
                foodSelect.disabled = true;
                pauseButton.disabled = false;
                pauseButton.textContent = "PAUZA";
                gameLoop();
                schedulePowerUpSpawn();
                updateActiveEffectDisplay(); // Znovu spust√≠ UI interval, pokud byl aktivn√≠ efekt
            } else if (wasPausedBeforeResize && wasRunningBeforeResize) {
                gamePaused = true;
                pauseOverlay.classList.remove('hidden');
                foodSelect.disabled = false;
                pauseButton.textContent = "POKRAƒåOVAT";
                pauseButton.disabled = false;
                updateActiveEffectDisplay(); // Zobraz√≠ stav efektu
            } else {
                initializeGameUI();
            }
        });

        // --- Inicializace ---
        function initializeGameUI() {
            resizeCanvas();
            initSnake();
            currentFoodEmoji = foodSelect.value;
            placeFood();
            draw();
            score = 0;
            scoreDisplay.textContent = score;
            foodSelect.disabled = false;
            pauseButton.disabled = true;
            messageOverlay.classList.add('hidden');
            pauseOverlay.classList.add('hidden');
            restartButton.classList.add('hidden');
            activeEffectDisplay.innerHTML = '';
            gamePaused = true;
            gameRunning = false;
            gameOverFlag = false;
            powerUp = null;
            activeEffect = null;
            if(gameLoopTimeout) clearTimeout(gameLoopTimeout);
            if(powerUpSpawnTimeout) clearTimeout(powerUpSpawnTimeout);
            if(powerUpDespawnTimeout) clearTimeout(powerUpDespawnTimeout);
            if(activeEffect?.timeoutId) clearTimeout(activeEffect.timeoutId);
            if(activeEffectUpdateInterval) clearInterval(activeEffectUpdateInterval);
        }

        initializeGameUI();
    </script>

</body>
</html>
